!function(){const e={welcomeMessage:"ðŸ‘‹ Hello! Ask me anything about our research!",apiUrl:"http://localhost:8000/ask",downloadFilename:"chat-history.md",chatbotName:"ðŸ¤– Chatbot",resetWarning:"Start a new conversation? This will erase current messages.",...window.ChatbotConfig||{}};function t(e,t){return new Promise(((a,n)=>{if(document.getElementById(t))return void a();const o=document.createElement("script");o.src=e,o.id=t,o.async=!0,o.onload=a,o.onerror=n,document.head.appendChild(o)}))}async function a(){await async function(){MathJax={tex:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]]},chtml:{scale:1}},await t("https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js","MathJax-script"),await t("https://cdn.jsdelivr.net/npm/marked/marked.min.js","marked-script")}();const a=document.createElement("button");a.className="fixed bottom-6 right-6 w-16 h-16 rounded-full bg-white/20 backdrop-blur-md border border-white/30 flex items-center justify-center shadow-xl hover:bg-white/30 transition duration-300 z-50",a.style.backdropFilter="saturate(180%) blur(10px)",a.textContent="ðŸ’¬";const n=document.createElement("div");n.style.display="none",n.className=["fixed inset-x-0 bottom-0","max-h-[75vh] h-[60vh] md:h-[75vh]","bg-white/50 backdrop-blur-lg","shadow-2xl","transform translate-y-full","transition-transform duration-300 ease-in-out","flex flex-col z-40"].join(" "),n.innerHTML=`\n      <div class="border-b border-gray-200 text-gray-800 text-base font-semibold flex justify-between items-center">\n        <span class="pl-4">${e.chatbotName}</span>\n        <div class="flex gap-0">\n          <button\n            id="chatbot-download"\n            class="text-base bg-white/20 backdrop-blur-md border border-white/30 text-gray-900 px-4 py-4 transition hover:bg-black/10"\n          >\n            Save Chat\n          </button>\n          <button\n            id="chatbot-reset"\n            class="text-base bg-white/20 backdrop-blur-md border border-white/30 text-gray-900 px-4 py-4 transition hover:bg-black/10"\n          >\n            New Chat\n          </button>\n        </div>\n      </div>\n      <div id="chatbot-body" class="container mx-auto px-8 flex-1 p-3 space-y-2 overflow-y-auto h-64 bg-white"></div>\n      <div class="flex border-t border-gray-200">\n        <textarea\n          id="chatbot-input"\n          placeholder="Type your message..."\n          rows="1"\n          class="flex-1 p-4 focus:outline-none resize-none rounded-bl-xl overflow-hidden leading-snug max-h-[8rem]"\n        ></textarea>\n        <button\n          id="chatbot-send"\n          class="px-4 py-2 bg-white/50 backdrop-blur-lg border border-white/30 text-gray-900 font-semibold hover:bg-black/10 transition rounded-br-xl"\n        >\n          Send\n        </button>\n      </div>\n    `,document.body.appendChild(a),document.body.appendChild(n),a.onclick=e=>{e.stopPropagation();const t=n.classList.contains("translate-y-full");n.classList.toggle("translate-y-full",!t),n.classList.toggle("translate-y-0",t),a.style.display=t?"none":"flex"},n.addEventListener("click",(e=>e.stopPropagation())),document.addEventListener("click",(()=>{n.classList.contains("translate-y-full")||(n.classList.add("translate-y-full"),n.classList.remove("translate-y-0"),a.style.display="flex")}));const o=n.querySelector("#chatbot-body");o.addEventListener("wheel",(e=>{const{scrollTop:t,scrollHeight:a,clientHeight:n}=o,s=0===t,r=t+n>=a,l=e.deltaY<0;(s&&l||r&&!l)&&e.preventDefault()}),{passive:!1}),document.addEventListener("keydown",(e=>{"Escape"!==e.key||n.classList.contains("translate-y-full")||(n.classList.remove("translate-y-0"),n.classList.add("translate-y-full"),a.style.display="flex")}));const s=n.querySelector("#chatbot-body"),r=n.querySelector("#chatbot-input"),l=n.querySelector("#chatbot-send"),i=n.querySelector("#chatbot-reset"),c=n.querySelector("#chatbot-download");function d(e,t,a=null){const n=document.createElement("div");n.className="py-2 px-4 rounded-lg prose prose-sm overflow-x-auto whitespace-pre-wrap break-words "+("user"===t?"bg-gray-100 self-end ml-auto text-right max-w-[60%]":"self-center mx-auto text-left max-w-[80%]");const o=a?new Date(a).toLocaleString():(new Date).toLocaleString(),r=document.createElement("div");return r.className="text-xs text-gray-400 -mt-2",r.textContent=o,n.innerHTML=marked.parse(e),n.querySelectorAll("pre").forEach((e=>{e.classList.add("overflow-x-auto","whitespace-pre","px-4","py-2","rounded-lg","bg-gray-50")})),n.appendChild(r),s.appendChild(n),s.scrollTop=s.scrollHeight,MathJax.typesetPromise([n]).then((()=>{n.querySelectorAll('mjx-math[display="true"]').forEach((e=>{const t=document.createElement("div");t.className="overflow-x-auto whitespace-nowrap px-2 py-1",e.replaceWith(t),t.append(e)}))})),n}function u(){return JSON.parse(localStorage.getItem("chatbot-history")||"[]")}function m(e,t,a=null){const n=u();n.push({text:e,from:t,timestamp:a||(new Date).toISOString()}),localStorage.setItem("chatbot-history",JSON.stringify(n))}async function h(){const t=r.value.trim();if(!t)return;d(t,"user"),m(t,"user"),r.value="";const a=d("_Thinking..._","bot");try{const n=await fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:t,history:u().map((({text:e,from:t})=>({role:"user"===t?"user":"assistant",content:e}))),embedding_model:"huggingface:thellert/physbert_cased",llm_model:"openai:gpt-4o-mini",max_documents:5,score_threshold:0,use_opensearch:!1,prompt:"You are a helpful assistant. Output answers in Markdown. Use $ and $$ to surround mathematical formulas. Try to tie your answer to the provided list of sources. Say you don't know if you can't. Be as concise as possible.",files:[]})}),o=(await n.json()).answer||"_Sorry, I couldn't generate a response._";a.remove(),d(o,"bot"),m(o,"bot")}catch(e){console.error("Error from backend:",e),a.remove();const t="_Failed to get a response from the server._";d(t,"bot"),m(t,"bot")}}l.onclick=h,r.addEventListener("input",(()=>{r.style.height="auto",r.style.height=r.scrollHeight+"px"})),r.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),h(),r.style.height="auto")})),i.onclick=()=>{e.resetWarning&&!confirm(e.resetWarning)||(localStorage.removeItem("chatbot-history"),s.innerHTML="",e.welcomeMessage&&(d(e.welcomeMessage,"bot"),m(e.welcomeMessage,"bot")))},c.onclick=function(){const t=u().map((({from:e,text:t,timestamp:a})=>`### ${"user"===e?"ðŸ§‘ User":"ðŸ¤– Assistant"}  \n*${a?new Date(a).toLocaleString():""}*\n\n${t.trim()}\n`)).join("\n---\n\n"),a=new Blob([t],{type:"text/markdown"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=e.downloadFilename,o.click(),URL.revokeObjectURL(n)};0===u().length&&e.welcomeMessage?(d(e.welcomeMessage,"bot"),m(e.welcomeMessage,"bot")):u().forEach((({text:e,from:t,timestamp:a})=>d(e,t,a))),n.style.display="",document.addEventListener("keydown",(e=>{const t=e.metaKey,o=e.ctrlKey;if((t||o)&&"k"===e.key.toLowerCase()){e.preventDefault();n.classList.contains("translate-y-full")?(n.classList.remove("translate-y-full"),n.classList.add("translate-y-0"),a.style.display="none"):(n.classList.remove("translate-y-0"),n.classList.add("translate-y-full"),a.style.display="flex")}}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()}();