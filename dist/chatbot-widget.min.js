!function(){const e={welcomeMessage:"ðŸ‘‹ Hello! Ask me anything about our research!",apiUrl:"http://localhost:8000/ask",downloadFilename:"chat-history.md",chatbotName:"ðŸ¤– Chatbot",resetWarning:"Start a new conversation? This will erase current messages.",...window.ChatbotConfig||{}};function t(e,t){return new Promise(((o,n)=>{if(document.getElementById(t))return void o();const a=document.createElement("script");a.src=e,a.id=t,a.async=!0,a.onload=o,a.onerror=n,document.head.appendChild(a)}))}async function o(){await async function(){MathJax={tex:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]]},chtml:{scale:1}},await t("https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js","MathJax-script"),await t("https://cdn.jsdelivr.net/npm/marked/marked.min.js","marked-script")}();const o=document.createElement("button");o.className="fixed bottom-4 right-4 w-14 h-14 rounded-full bg-blue-600 text-white text-2xl flex items-center justify-center shadow-lg hover:bg-blue-700 z-50",o.textContent="ðŸ’¬";const n=document.createElement("div");n.className="fixed bottom-20 right-4 w-80 max-h-[75vh] bg-white rounded-xl shadow-2xl flex-col hidden z-40",n.innerHTML=`\n      <div class="bg-blue-600 text-white text-lg font-semibold px-4 py-2 rounded-t-xl flex justify-between items-center">\n        <span>${e.chatbotName}</span>\n        <div class="flex gap-2">\n          <button id="chatbot-download" class="text-sm bg-blue-500 hover:bg-blue-700 px-2 py-1 rounded">\n            Save Chat\n          </button>\n          <button id="chatbot-reset" class="text-sm bg-blue-500 hover:bg-blue-700 px-2 py-1 rounded">\n            New Chat\n          </button>\n        </div>\n      </div>\n      <div id="chatbot-body" class="flex-1 p-3 space-y-2 overflow-y-auto h-64 text-sm"></div>\n      <div class="flex border-t border-gray-300">\n        <textarea\n          id="chatbot-input"\n          placeholder="Type your message..."\n          rows="1"\n          class="flex-1 px-3 py-2 text-sm focus:outline-none resize-none rounded-bl-xl overflow-hidden leading-snug max-h-[8rem]"\n        ></textarea>\n        <button\n          id="chatbot-send"\n          class="px-4 py-2 bg-blue-600 text-sm text-white font-semibold hover:bg-blue-700 rounded-br-xl"\n        >\n          Send\n        </button>\n      </div>\n    `,document.body.appendChild(o),document.body.appendChild(n);const a=n.querySelector("#chatbot-body"),s=n.querySelector("#chatbot-input"),r=n.querySelector("#chatbot-send"),l=n.querySelector("#chatbot-reset"),c=n.querySelector("#chatbot-download");function i(e,t,o=null){const n=document.createElement("div");n.className="py-2 px-4 rounded-lg max-w-[80%] prose prose-sm text-sm overflow-x-auto whitespace-pre-wrap break-words "+("user"===t?"bg-blue-100 self-end ml-auto text-right":"bg-gray-100 self-start mr-auto text-left");const s=o?new Date(o).toLocaleString():(new Date).toLocaleString(),r=document.createElement("div");return r.className="text-xs text-gray-400 -mt-2",r.textContent=s,n.innerHTML=marked.parse(e),n.querySelectorAll("pre").forEach((e=>{e.classList.add("overflow-x-auto","whitespace-pre","px-4","py-2","rounded-lg","bg-gray-50")})),n.appendChild(r),a.appendChild(n),a.scrollTop=a.scrollHeight,MathJax.typesetPromise([n]).then((()=>{n.querySelectorAll('mjx-math[display="true"]').forEach((e=>{const t=document.createElement("div");t.className="overflow-x-auto whitespace-nowrap px-2 py-1",e.replaceWith(t),t.append(e)}))})),n}function d(){return JSON.parse(localStorage.getItem("chatbot-history")||"[]")}function m(e,t,o=null){const n=d();n.push({text:e,from:t,timestamp:o||(new Date).toISOString()}),localStorage.setItem("chatbot-history",JSON.stringify(n))}async function u(){const t=s.value.trim();if(!t)return;i(t,"user"),m(t,"user"),s.value="";const o=i("_Thinking..._","bot");try{const n=await fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:t,history:d().map((({text:e,from:t})=>({role:"user"===t?"user":"assistant",content:e}))),embedding_model:"huggingface:thellert/physbert_cased",llm_model:"ollama:llama3.1:latest",max_documents:5,score_threshold:0,use_opensearch:!1,prompt:"You are a helpful assistant. Output answers in Markdown. Use $ and $$ to surround mathematical formulas. Try to tie your answer to the provided list of sources. Say you don't know if you can't. Be as concise as possible.",files:[]})}),a=(await n.json()).answer||"_Sorry, I couldn't generate a response._";o.remove(),i(a,"bot"),m(a,"bot")}catch(e){console.error("Error from backend:",e),o.remove();const t="_Failed to get a response from the server._";i(t,"bot"),m(t,"bot")}}o.onclick=()=>{n.classList.toggle("hidden"),n.classList.add("flex")},r.onclick=u,s.addEventListener("input",(()=>{s.style.height="auto",s.style.height=s.scrollHeight+"px"})),s.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u(),s.style.height="auto")})),l.onclick=()=>{e.resetWarning&&!confirm(e.resetWarning)||(localStorage.removeItem("chatbot-history"),a.innerHTML="",e.welcomeMessage&&(i(e.welcomeMessage,"bot"),m(e.welcomeMessage,"bot")))},c.onclick=function(){const t=d().map((({from:e,text:t,timestamp:o})=>`### ${"user"===e?"ðŸ§‘ User":"ðŸ¤– Assistant"}  \n*${o?new Date(o).toLocaleString():""}*\n\n${t.trim()}\n`)).join("\n---\n\n"),o=new Blob([t],{type:"text/markdown"}),n=URL.createObjectURL(o),a=document.createElement("a");a.href=n,a.download=e.downloadFilename,a.click(),URL.revokeObjectURL(n)},n.classList.add("flex"),n.classList.add("flex-col"),n.classList.add("hidden");0===d().length&&e.welcomeMessage?(i(e.welcomeMessage,"bot"),m(e.welcomeMessage,"bot")):d().forEach((({text:e,from:t,timestamp:o})=>i(e,t,o)))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o()}();