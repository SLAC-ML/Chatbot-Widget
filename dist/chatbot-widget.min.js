!function(){const e={welcomeMessage:"ðŸ‘‹ Hello! Ask me anything about our research!",apiUrl:"http://localhost:8000/ask",downloadFilename:"chat-history.md",chatbotName:"ðŸ¤– Chatbot",resetWarning:"Start a new conversation? This will erase current messages.",...window.ChatbotConfig||{}};function t(e,t){return new Promise(((n,a)=>{if(document.getElementById(t))return void n();const o=document.createElement("script");o.src=e,o.id=t,o.async=!0,o.onload=n,o.onerror=a,document.head.appendChild(o)}))}async function n(){await async function(){MathJax={tex:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]]},chtml:{scale:1}},await t("https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js","MathJax-script"),await t("https://cdn.jsdelivr.net/npm/marked/marked.min.js","marked-script")}();const n=document.createElement("button");n.className="fixed bottom-6 right-6 w-16 h-16 rounded-full bg-white/20 backdrop-blur-md border border-white/30 flex items-center justify-center shadow-xl hover:bg-white/30 transition duration-300 z-50",n.style.backdropFilter="saturate(180%) blur(10px)",n.textContent="ðŸ’¬";const a=document.createElement("div");a.style.display="none",a.className=["fixed inset-x-0 bottom-0","max-h-[75vh] h-[60vh] md:h-[75vh]","bg-white/50 backdrop-blur-lg","shadow-2xl","transform translate-y-full","transition-transform duration-300 ease-in-out","flex flex-col z-40"].join(" "),a.innerHTML=`\n      <div class="border-b border-gray-200 text-gray-800 text-base font-semibold flex justify-between items-center">\n        <span class="pl-4">${e.chatbotName}</span>\n        <div class="flex gap-0">\n          <button\n            id="chatbot-download"\n            class="text-base bg-white/20 backdrop-blur-md border border-white/30 text-gray-900 px-4 py-4 transition hover:bg-black/10"\n          >\n            Save Chat\n          </button>\n          <button\n            id="chatbot-reset"\n            class="text-base bg-white/20 backdrop-blur-md border border-white/30 text-gray-900 px-4 py-4 transition hover:bg-black/10"\n          >\n            New Chat\n          </button>\n          <button\n            id="chatbot-use-rag"\n            class="text-base bg-white/20 backdrop-blur-md border border-white/30 text-gray-900 px-4 py-4 transition hover:bg-black/10 flex items-center gap-2"\n          >\n            <input type="checkbox" id="use-rag-checkbox" class="mr-2" />\n            Use RAG\n          </button>\n        </div>\n      </div>\n      <div id="chatbot-body" class="px-[clamp(1rem,calc((100vw-1024px)/2),100rem)] flex-1 py-3 space-y-2 overflow-y-auto h-64 bg-white"></div>\n      <div class="flex border-t border-gray-200">\n        <textarea\n          id="chatbot-input"\n          placeholder="Type your message..."\n          rows="1"\n          class="flex-1 p-4 focus:outline-none resize-none rounded-bl-xl overflow-hidden leading-snug max-h-[8rem]"\n        ></textarea>\n        <button\n          id="chatbot-send"\n          class="px-4 py-2 bg-white/50 backdrop-blur-lg border border-white/30 text-gray-900 font-semibold hover:bg-black/10 transition rounded-br-xl"\n        >\n          Send\n        </button>\n      </div>\n    `;const o=a.querySelector("#chatbot-use-rag"),s=a.querySelector("#use-rag-checkbox");o.addEventListener("click",(e=>{e.preventDefault(),s.checked=!s.checked})),document.body.appendChild(n),document.body.appendChild(a),n.onclick=e=>{e.stopPropagation();const t=a.classList.contains("translate-y-full");a.classList.toggle("translate-y-full",!t),a.classList.toggle("translate-y-0",t),n.style.display=t?"none":"flex"},a.addEventListener("click",(e=>e.stopPropagation())),document.addEventListener("click",(()=>{a.classList.contains("translate-y-full")||(a.classList.add("translate-y-full"),a.classList.remove("translate-y-0"),n.style.display="flex")}));const r=a.querySelector("#chatbot-body");r.addEventListener("wheel",(e=>{const{scrollTop:t,scrollHeight:n,clientHeight:a}=r,o=0===t,s=t+a>=n,l=e.deltaY<0;(o&&l||s&&!l)&&e.preventDefault()}),{passive:!1}),document.addEventListener("keydown",(e=>{"Escape"!==e.key||a.classList.contains("translate-y-full")||(a.classList.remove("translate-y-0"),a.classList.add("translate-y-full"),n.style.display="flex")}));const l=a.querySelector("#chatbot-body"),i=a.querySelector("#chatbot-input"),c=a.querySelector("#chatbot-send"),d=a.querySelector("#chatbot-reset"),h=a.querySelector("#chatbot-download");function p(e,t,n=null,a=[]){const o=document.createElement("div");o.className="py-2 px-4 rounded-lg prose prose-sm overflow-x-auto whitespace-pre-wrap break-words "+("user"===t?"bg-gray-100 self-end ml-auto mr-4 text-right max-w-[60%]":"self-center mx-auto text-left w-full");const s=n?new Date(n).toLocaleString():(new Date).toLocaleString(),r=document.createElement("div");if(r.className="text-xs text-gray-400 -mt-2",r.textContent=s,o.innerHTML=marked.parse(e),o.querySelectorAll("pre").forEach((e=>{e.classList.add("overflow-x-auto","whitespace-pre","px-4","py-2","rounded-lg","bg-gray-50")})),o.appendChild(r),"bot"===t&&a.length){const e=document.createElement("div");e.className="mt-4 bg-gray-50 rounded-lg";const t=document.createElement("button");t.type="button",t.className="w-full flex items-center gap-2 p-4 text-sm font-medium text-gray-800 cursor-pointer",t.innerHTML=`\n          <svg\n            class="w-5 h-5 text-blue-500 transition-transform"\n            xmlns="http://www.w3.org/2000/svg"\n            fill="none"\n            viewBox="0 0 24 24"\n            stroke="currentColor"\n          >\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"\n                  d="M9 5l7 7-7 7" />\n          </svg>\n          <span>${a.length} source${a.length>1?"s":""}</span>\n        `,e.appendChild(t);const n=document.createElement("div");n.className="overflow-hidden",n.style.height="0px",n.style.opacity="0",n.style.transition="height 0.3s ease, opacity 0.2s ease",n.style.willChange="height, opacity",a.forEach((e=>{const t=document.createElement("div");t.className="m-2 text-sm text-gray-700 bg-white rounded-md shadow-xs",t.innerHTML=`\n            <strong>${e.id}</strong> (score: ${e.score.toFixed(2)})<br>\n            ${e.snippet.replace(/\n/g,"<br>")}â€¦\n          `,n.appendChild(t)})),e.appendChild(n);const s=t.querySelector("svg");t.addEventListener("click",(()=>{const e=t.classList.toggle("open"),a=n.scrollHeight+"px";e?(n.style.height="0px",n.style.opacity="0",requestAnimationFrame((()=>{n.style.height=a,n.style.opacity="1",s.style.transform="rotate(90deg)"}))):(n.style.height=a,n.style.opacity="1",requestAnimationFrame((()=>{n.style.height="0px",n.style.opacity="0",s.style.transform=""})))})),n.addEventListener("transitionend",(e=>{"height"===e.propertyName&&t.classList.contains("open")&&(n.style.height="auto")})),o.appendChild(e)}return l.appendChild(o),l.scrollTop=l.scrollHeight,MathJax.typesetPromise([o]).then((()=>{o.querySelectorAll('mjx-math[display="true"]').forEach((e=>{const t=document.createElement("div");t.className="overflow-x-auto whitespace-nowrap px-2 py-1",e.replaceWith(t),t.append(e)}))})),o}function u(){return JSON.parse(localStorage.getItem("chatbot-history")||"[]")}function m(e,t,n=null,a=[]){const o=u();o.push({text:e,from:t,timestamp:n||(new Date).toISOString(),docs:a}),localStorage.setItem("chatbot-history",JSON.stringify(o))}async function y(){const t=i.value.trim();if(!t)return;p(t,"user"),m(t,"user"),i.value="";const n=p("_Thinking..._","bot");try{const a=await fetch(e.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({query:t,history:u().map((({text:e,from:t})=>({role:"user"===t?"user":"assistant",content:e}))),embedding_model:"huggingface:thellert/physbert_cased",llm_model:"openai:gpt-4o-mini",use_rag:s.checked,max_documents:5,score_threshold:0,use_opensearch:!1,prompt:"You are a helpful assistant. Output answers in Markdown. Use $ and $$ to surround mathematical formulas. Try to tie your answer to the provided list of sources. Say you don't know if you can't. Be as concise as possible.",files:[]})}),o=await a.json(),r=o.answer||"_Sorry, I couldn't generate a response._",l=o.documents||[];n.remove(),p(r,"bot",null,l),m(r,"bot",null,l)}catch(e){console.error("Error from backend:",e),n.remove();const t="_Failed to get a response from the server._";p(t,"bot"),m(t,"bot")}}c.onclick=y,i.addEventListener("input",(()=>{i.style.height="auto",i.style.height=i.scrollHeight+"px"})),i.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y(),i.style.height="auto")})),d.onclick=()=>{e.resetWarning&&!confirm(e.resetWarning)||(localStorage.removeItem("chatbot-history"),l.innerHTML="",e.welcomeMessage&&(p(e.welcomeMessage,"bot"),m(e.welcomeMessage,"bot")))},h.onclick=function(){const t=u().map((({from:e,text:t,timestamp:n})=>`### ${"user"===e?"ðŸ§‘ User":"ðŸ¤– Assistant"}  \n*${n?new Date(n).toLocaleString():""}*\n\n${t.trim()}\n`)).join("\n---\n\n"),n=new Blob([t],{type:"text/markdown"}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=e.downloadFilename,o.click(),URL.revokeObjectURL(a)};0===u().length&&e.welcomeMessage?(p(e.welcomeMessage,"bot"),m(e.welcomeMessage,"bot")):u().forEach((({text:e,from:t,timestamp:n,docs:a})=>p(e,t,n,a||[]))),a.style.display="",document.addEventListener("keydown",(e=>{const t=e.metaKey,o=e.ctrlKey;if((t||o)&&"k"===e.key.toLowerCase()){e.preventDefault();a.classList.contains("translate-y-full")?(a.classList.remove("translate-y-full"),a.classList.add("translate-y-0"),n.style.display="none"):(a.classList.remove("translate-y-0"),a.classList.add("translate-y-full"),n.style.display="flex")}}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}();